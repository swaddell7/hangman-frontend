function mackMain() {
    displayWord(hiddenWord)
    letterButtons()
}

// Alphabet array for letter select
let alphabet = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k',
    'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']

// Words sample array
let words = ['noodle', 'cat', 'spaceship', 'fire', 'code', 'house', 'tree', 'cowboy', 'farm', 'raza', 'jess', 'duke', 'mack', 'stefani', 'store', 'computer', 'google', 'desk', 'table', 'chair', 'television', 'auz', 'party', 'birthday', 'cake', 'pie', 'apple', 'buttercup', 'chocolate', 'hangman', 'game', 'park', 'headphones', 'sound', 'money', 'dollar', 'wedge', 'fight', 'brawl', 'pillar', 'tower', 'monument', 'arch', 'door', 'floor', 'ceiling', 'wall', 'brick', 'gravel', 'concrete', 'grass', 'leaf', 'pear', 'grapefruit', 'vanilla', 'pudding', 'wafer', 'cookie', 'icecream', 'flavor', 'color', 'taste', 'vision', 'matrix', 'watermelon', 'sandwich', 'burger', 'pizza', 'yogurt', 'keyboard', 'paper', 'shades', 'sunglasses', 'cactus', 'plant', 'salad', 'glass', 'cup', 'hydroflask', 'whale', 'dolphin', 'fish', 'shark', 'dog', 'puppy', 'pupper', 'goldfish', 'husky', 'coyote', 'dachshund', 'terrier', 'bird', 'chirp', 'twitter', 'instagram', 'social', 'website', 'html', 'css', 'javascript', 'java', 'c', 'sql', 'ruby', 'mouse', 'rat', 'card', 'poker', 'circle', 'rectangle', 'triangle', 'trapezoid', 'zoo', 'word', 'guess', 'jeans', 'blue', 'red', 'green', 'yellow', 'racecar', 'lion', 'powwow', 'pzazz', 'tiger', 'xerox', 'microsoft', 'peewee', 'football', 'basketball', 'baseball', 'diamond', 'silver', 'gold', 'metal', 'steel', 'iron', 'magenta', 'magnificent', 'caveman', 'club', 'yoke', 'world', 'oogabooga']

// Iterate over alphabet array and create a button for each letter
function letterButtons() {
    const lettersContainer = document.querySelector('#letters-container')
    lettersContainer.innerHTML = ``
    for (let i = 0; i < alphabet.length; i++) {
        lettersContainer.innerHTML +=
            `<button type="button" id="letter-button">${alphabet[i]}</button>`
    }
    lettersContainer.addEventListener('click', event => letterGuess(event))
}

let wordToGuess = words[Math.floor(Math.random() * words.length)]
let wordDisplay = document.querySelector('.word')
let hiddenWord = wordToGuess.replace(/[a-z]/gi, '_')
let hiddenWordSpaced = hiddenWord.split('')

console.log(wordToGuess)
function displayWord(hiddenWord) {
    wordDisplay.innerHTML = `${hiddenWordSpaced.join(' ')}`
}

let letter
let buttonLetter
let splitWord = wordToGuess.split('')

function letterGuess(event) {
    buttonLetter = document.querySelector('#letter-button').innerHTML
    if (event.target.id === 'letter-button') {
        if (!splitWord.includes(event.target.innerHTML)) {
            incorrectGuess();
        }
        for (let i = 0; i < splitWord.length; i++) {
            if (event.target.innerHTML === splitWord[i]) {
                let changedWord = wordDisplay.innerText
                console.log(changedWord)
                changedWord = changedWord.replace(/ /g, '').split('')
                changedWord[i] = event.target.innerHTML
                let updatedWord = changedWord.join(' ')
                wordDisplay.innerText = updatedWord
                if (changedWord.join('') === wordToGuess) {
                    console.log(wordToGuess)
                    getUser(event);
                    nextRound();
                    setTimeout(function () {
                    }, 1000)
                }
            }
        }
    }
}

let incorrectGuesses = 0
function incorrectGuess() {
    incorrectGuesses += 1

    imageContainer = document.querySelector('.hangman-image');
    if (incorrectGuesses === 1) {
        imageContainer.src = 'images/hangman-phases/hangman_2.png'
    } else if (incorrectGuesses === 2) {
        imageContainer.src = 'images/hangman-phases/hangman_3.png'
    } else if (incorrectGuesses === 3) {
        imageContainer.src = 'images/hangman-phases/hangman_4.png'
    } else if (incorrectGuesses === 4) {
        imageContainer.src = 'images/hangman-phases/hangman_5.png'
    } else if (incorrectGuesses === 5) {
        imageContainer.src = 'images/hangman-phases/hangman_6.png'
    } else if (incorrectGuesses === 6) {
        imageContainer.src = 'images/hangman-phases/hangman_final.png';
        handleGameOver()
    }
}


function nextRound() {
    const nextRoundView = document.querySelector('#next-round-view');
    nextRoundView.style.display = 'block'
}

function getUser(event) {
    const userId = parseInt(event.target.parentNode.dataset.id)
    fetch(`${usersUrl}/${userId}`)
        .then(resp => resp.json())
        .then(user => addPoint(user))
}

function addPoint(user) {
    const newPoints = user.points + 1
    const reqObj = {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({ 'points': newPoints })
    }
    fetch(`${usersUrl}/${user.id}`, reqObj)
        .then(resp => resp.json())
        .then(user => updatePoints(user))
}

function updatePoints(user) {
    pointsContainer = document.querySelector('#current-score');
    pointsContainer.innerHTML = `Score: ${user.points}`
}

const nextRoundButton = document.querySelector('#next-round-button');
const nextRoundView = document.querySelector('#next-round-view');
nextRoundButton.addEventListener('click', function () {
    nextRoundView.style.display = 'none'
    wordToGuess = words[Math.floor(Math.random() * words.length)]
    splitWord = wordToGuess.split('')
    wordDisplay = document.querySelector('.word')
    hiddenWord = wordToGuess.replace(/[a-z]/gi, '_')
    hiddenWordSpaced = hiddenWord.split('')
    displayWord(hiddenWord);
})

function handleGameOver() {
    const loginView = document.querySelector('#login-view')
    const startGameView = document.querySelector('#start-game-view')
    const gameView = document.querySelector('#game-view')
    const gameOverView = document.querySelector('#game-over-view')

    loginView.style.display = 'none';
    startGameView.style.display = 'none';
    gameView.style.display = 'none';
    gameOverView.style.display = 'block'

    getUsers()
}

function getUsers() {
    fetch(usersUrl)
    .then(resp => resp.json())
    .then(users => showLeaderboard(users))
}

// function getCurrentUser() {
//     currentUserId = document.querySelector('#game-over-view').dataset.id
//     fetch(`${usersUrl}/${currentUserId}`)
//     .then(resp => resp.json())
//     .then(currentUser => showLeaderboard(currentUser))
// }

function showLeaderboard(users) {
    const failedWord = document.querySelector('#failed-word')
    const leaderboard = document.querySelector('#leaderboard')
    const sortedUsers = users.sort((a, b) => (a.points < b.points) ? 1 : -1)
    sortedUsers.forEach(user => leaderboard.innerHTML += `<li>${user.username} | ${user.points}`);
    failedWord.innerHTML = `Your last word was: ${wordToGuess}`
}

mackMain()